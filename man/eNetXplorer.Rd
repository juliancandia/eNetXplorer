\name{eNetXplorer}
\alias{eNetXplorer}
%- Also NEED an '\alias' for EACH other topic documented here.
\title{Generates family of elastic net models for different alphas  
%%  ~~function to do ... ~~
}
\description{
Elastic nets use a mixing parameter \code{alpha} to tune the penalty term continuously from ridge (\code{alpha=0}) to lasso (\code{alpha=1}). This function generates a family of elastic net models over different values of \code{alpha} for the quantitative exploration of the effects of shrinkage. For each \code{alpha}, the regularization parameter \code{lambda} is chosen by optimizing a quality function based on out-of-bag cross-validation predictions. Statistical significance of each model, as well as that of individual features within a model, 
is assigned by comparison to a set of null models generated by random permutations of the response. This function fits linear (gaussian), logistic (binomial) and multinomial models. 

}
\usage{
eNetXplorer(x, y, family=c("gaussian","binomial","multinomial"), alpha=seq(0,1,by=0.2), nlambda=100, nlambda.ext=NULL,
seed=NULL, scaled=T, n_fold=5, n_run=100, n_perm_null=25, QF.FUN=NULL, QF_label=NULL, cor_method=c("pearson","kendall","spearman"), fold_distrib_fail.max=100, ...)
}
%- maybe also 'usage' for other objects documented here.
\arguments{
  \item{x}{Input numerical matrix with instances as rows and features as columns. Instance and feature labels should be provided as row and column names, respectively. Can be in sparse matrix format (inherit from class \code{"sparseMatrix"} as in package \code{Matrix}). Cannot handle missing values.}
  \item{y}{Response variable. For \code{family="gaussian"}, numerical vector. For \code{family="binomial"}, factor with two levels. For \code{family="multinomial"}, factor with two or more levels. For categorical families, if a character vector is supplied, it will be coerced into a factor.}
\item{family}{Response type:  \code{"gaussian"} (numerical), \code{"binomial"} (2-level factor), or \code{"multinomial"} (factor with >=2 levels).}
\item{alpha}{Sequence of values for the mixing parameter penalty term in the elastic net family. Default is \code{seq(0,1,by=0.2)}.}
\item{nlambda}{Number of values for 
the regularization parameter \code{lambda}. Default is 100. Irrespective of \code{nlambda}, the range of \code{lambda} values is assigned by \code{glmnet}.}
\item{nlambda.ext}{If set to a value larger than \code{nlambda}, this will be the number of values for \code{lambda} obtained by extending the range assigned by \code{glmnet} symmetrically while keeping the \code{lambda} density constant (in log scale). Default is \code{NULL}, which will not extend the range of \code{lambda} assigned by \code{glmnet}.}
\item{seed}{Sets the pseudo-random number seed to enforce  reproducibility. Default is \code{NULL}.}
\item{scaled}{Z-score transformation of individual features across all instances. Default is \code{TRUE}.}
\item{n_fold}{Number of cross-validation folds per run. \code{lambda} is chosen based on the maximization of a quality function on out-of-bag-instances averaged over all runs. Default is 5.}
\item{n_run}{Number of runs; for each run, instances are randomly assigned to cross-validation folds. Default is 100.}
\item{n_perm_null}{Number of random null-model permutations of the response per run. Default is 25.}
\item{QF.FUN}{User-defined quality function as maximization criterion to select \code{lambda} based on response vs out-of-bag predicted instances. For \code{family="gaussian"}, the default is correlation; for \code{family="binomial"}, it is accuracy; for \code{family="multinomial"}, it is average accuracy.}
\item{QF_label}{Label for user-defined quality function, if QF.FUN is provided.}
\item{cor_method}{Correlation method to be used in the default quality function \code{cor.test} for \code{family="gaussian"}. Default is \code{"pearson"}.}
\item{fold_distrib_fail.max}{For categorical models, maximum number of failed attempts per run to have all classes represented in each in-bag fold. If this number is exceeded, the execution is halted; try again with larger \code{n_fold}, by removing/reasigning classes of small size, and/or with larger \code{fold_distrib_fail.max}. Default is 100.}
  \item{\dots}{Accepts parameters from \code{glmnet.control(\dots)} to allow changes of factory default parameters in \code{glmnet}. If not explicitly set, it will use factory defaults.}
}
\details{
For each \code{alpha}, a set of \code{nlambda} values is 
obtained using the full data; if provided, \code{nlambda.ext} 
allows to extend the range of \code{lambda} values symmetrically while keeping its density constant (in log scale). Using these 
values of \code{lambda}, elastic net cross-validation models are generated for \code{n_run} random assignments of instances among \code{n_fold} folds; the optimal \code{lambda} is determined
by the maximization of a quality function that compares out-of-bag predictions against the response. User-defined quality functions can be provided via \code{QF.FUN}, otherwise sensible defaults are used (e.g. correlation for gaussian models).
For each run, using the same assignment of instances into folds, \code{n_perm_null} null models are generated by shuffling the response. By using the quality function to compare the out-of-bag performance of the model to that of the null models, 
an empirical significance p-value is assigned to the model.
Similar procedures allow to obtain p-values for individual features based on absolute coefficient magnitude and on the frequency of non-zero coefficients. 

A family of elastic net models is thus generated for multiple 
values of \code{alpha} typically spanning the range from   
ridge (\code{alpha=0}) to lasso (\code{alpha=1}). This function 
returns an \code{eNetXplorer} object on which summary, plotting 
and export functions in this package can be applied for further 
analysis. 

For details about the underlying elastic net models, please refer to the \code{glmnet} package and references therein. 
%%  ~~ If necessary, more details than the description above ~~
}
\value{
An object with S3 class \code{"eNetXplorer"}.
\item{predictor}{}
\item{response}{}
\item{family}{}
\item{alpha}{}
\item{nlambda}{}
\item{nlambda.ext}{}
\item{seed}{}
\item{scaled}{}
\item{n_fold}{}
\item{n_run}{}
\item{n_perm_null}{}
\item{QF_label}{}
\item{instance}{}
\item{feature}{}
\item{fold_distrib_fail.max}{}
\item{glmnet_params}{}
\item{best_lambda}{}
\item{model_QF_est}{}
\item{QF_model_vs_null_pval}{}
\item{lambda_values}{}
\item{lambda_QF_est}{}
\item{predicted_values}{}
\item{feature_coef_wmean}{}
\item{feature_coef_wsd}{}
\item{feature_freq_mean}{}
\item{feature_freq_sd}{}
\item{null_feature_coef_wmean}{}
\item{null_feature_coef_wsd}{}
\item{null_feature_freq_mean}{}
\item{null_feature_freq_sd}{}
\item{feature_coef_model_vs_null_pval}{}
\item{feature_freq_model_vs_null_pval}{}
}
\references{
%% ~put references to the literature/web site here ~
}
\author{Julian Candia and John S. Tsang\cr 
Maintainer: Julian Candia \email{julian.candia@nih.gov}}
\note{
%%  ~~further notes~~
}

%% ~Make other sections like Warning with \section{Warning }{....} ~

\seealso{%\code{summary}, \code{Export}, \code{pdf.summary}, and plotting methods \code{lambda.vs.QF}, \code{measured.vs.oob}, \code{feature.caterpillar}, \code{feature.heatmap} and \code{contingency}. 
}

\examples{
\dontrun{
# Gaussian eNetXplorer models (synthetic dataset comprised of 20 features and 75 instances):
data(QuickStartExample)
result = eNetXplorer(x=QuickStartExample$predictor,y=QuickStartExample$response,family="gaussian",n_run=25,n_perm_null=20,seed=111)

# Gaussian eNetXplorer models to predict H1N1 serum titers at day 70 based on cell subpopulation frequencies at day 7:
data(H1N1_Flow)
result = eNetXplorer(x=H1N1_Flow$predictor_day7,y=H1N1_Flow$response[rownames(H1N1_Flow$predictor_day7)],family="gaussian",n_run=25,n_perm_null=20,seed=111)

# Binomial eNetXplorer models to predict acute myeloid (AML) vs acute lymphoblastic (ALL) leukemias: 
data(Leukemia_miR)
result = eNetXplorer(x=Leukemia_miR$predictor,y=Leukemia_miR$response_binomial,family="binomial",n_run=25,n_perm_null=20,seed=111)

# Multinomial eNetXplorer models to predict acute myeloid (AML), acute B-cell lymphoblastic (B-ALL) and acute T-cell lymphoblastic (T-ALL) leukemias:
data(Leukemia_miR)
result = eNetXplorer(x=Leukemia_miR$predictor,y=Leukemia_miR$response_multinomial,family="multinomial",n_run=25,n_perm_null=20,seed=111)

# Binomial eNetXplorer models to predict B-ALL vs T-ALL:
data(Leukemia_miR)
result = eNetXplorer(x=Leukemia_miR$predictor[Leukemia_miR$response_multinomial!="AML",],y=Leukemia_miR$response_multinomial[Leukemia_miR$response_multinomial!="AML"],family="binomial",n_run=25,n_perm_null=20,seed=111)
}
}
% \keyword{ ~kwd1 }% use one of  RShowDoc("KEYWORDS")
% \keyword{ ~kwd2 }% __ONLY ONE__ keyword per line
